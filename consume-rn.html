<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Dibuja y detecta triángulos</title>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.min.js"></script>
  <style>
    body { background-color: antiquewhite; text-align: center; font-family: Arial; }
    canvas { border: 1px solid black; margin-top: 10px; }
    button { margin-top: 10px; }
  </style>
</head>
<body>

<h2>Dibuja un triángulo con el mouse</h2>
<p id="mensaje">Dibuja libremente un triángulo y suelta el mouse para detectar</p>
<button onclick="limpiar()">Limpiar</button>

<script>
  let puntos = [];
  let vertices = [];

  function setup() {
    createCanvas(400, 400);
    background(255);
  }

  function draw() {
    // Fondo blanco
    background(255);

    // Dibuja lo que el usuario ha pintado
    stroke(0);
    strokeWeight(4);
    noFill();
    beginShape();
    for(let p of puntos){
      vertex(p.x, p.y);
    }
    endShape();

    // Si tenemos vertices detectados, dibujarlos
    strokeWeight(12);
    stroke('red');
    for(let v of vertices){
      point(v.x, v.y);
    }

    // Si hay 3 vertices, dibuja líneas para visualizar triángulo detectado
    if(vertices.length === 3){
      strokeWeight(3);
      stroke('blue');
      line(vertices[0].x, vertices[0].y, vertices[1].x, vertices[1].y);
      line(vertices[1].x, vertices[1].y, vertices[2].x, vertices[2].y);
      line(vertices[2].x, vertices[2].y, vertices[0].x, vertices[0].y);
    }
  }

  function mouseDragged() {
    // Guardar puntos mientras se arrastra el mouse
    puntos.push(createVector(mouseX, mouseY));
  }

  function mouseReleased() {
    if(puntos.length < 10){
      document.getElementById('mensaje').innerText = "Dibuja más grande y claro.";
      return;
    }
    vertices = detectarVertices(puntos);
    if(vertices.length < 3){
      document.getElementById('mensaje').innerText = "No se detectaron 3 vértices claros, dibuja un triángulo más definido.";
      return;
    }
    let tipo = tipoTriangulo(vertices);
    document.getElementById('mensaje').innerText = "Triángulo detectado: " + tipo;
  }

  function limpiar() {
    puntos = [];
    vertices = [];
    background(255);
    document.getElementById('mensaje').innerText = "Dibuja un triángulo con el mouse";
  }

  // Detectar 3 vertices simples buscando puntos donde la dirección cambia mucho
  function detectarVertices(puntos) {
    let vertices = [];
    for(let i = 5; i < puntos.length - 5; i++){
      let prev = puntos[i - 5];
      let curr = puntos[i];
      let next = puntos[i + 5];

      // Vectores normalizados
      let v1 = createVector(curr.x - prev.x, curr.y - prev.y).normalize();
      let v2 = createVector(next.x - curr.x, next.y - curr.y).normalize();

      // Producto punto entre vectores (ángulo)
      let angulo = v1.dot(v2);

      // Si el ángulo es pequeño, hay cambio brusco => posible vértice
      if(angulo < 0.7){
        // Evitar puntos muy cercanos entre sí
        let cerca = vertices.some(v => dist(curr.x, curr.y, v.x, v.y) < 30);
        if(!cerca){
          vertices.push(curr);
        }
      }
    }
    return vertices.slice(0, 3); // Solo primeros 3 vértices
  }

  // Calcular tipo de triángulo según lados
  function tipoTriangulo(v) {
    let d1 = dist(v[0].x, v[0].y, v[1].x, v[1].y);
    let d2 = dist(v[1].x, v[1].y, v[2].x, v[2].y);
    let d3 = dist(v[2].x, v[2].y, v[0].x, v[0].y);

    const tol = 15; // tolerancia para igualdades

    if(abs(d1 - d2) < tol && abs(d2 - d3) < tol){
      return "Equilátero";
    } else if(abs(d1 - d2) < tol || abs(d2 - d3) < tol || abs(d1 - d3) < tol){
      return "Isósceles";
    } else {
      return "Escaleno";
    }
  }
</script>

</body>
</html>
